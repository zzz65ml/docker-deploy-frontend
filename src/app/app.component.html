<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>分数等级计算器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- 配置Tailwind自定义颜色 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            excellent: '#10b981', // 优秀(绿色)
            good: '#3b82f6',     // 良好(蓝色)
            pass: '#f59e0b',     // 及格(橙色)
            fail: '#ef4444',     // 不及格(红色)
          },
        },
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      .bg-gradient {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
<div class="container mx-auto px-4 py-8 max-w-4xl">
  <!-- 评分说明卡片 -->
  <div class="bg-white rounded-xl p-6 mb-8 card-shadow transform hover:scale-[1.01] transition-all duration-300">
    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
      <i class="fa fa-info-circle text-blue-500 mr-2"></i>评分标准说明
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="flex items-center p-3 rounded-lg bg-excellent/10 border-l-4 border-excellent">
        <span class="font-bold mr-2">优秀:</span>
        <span>90-100分</span>
      </div>
      <div class="flex items-center p-3 rounded-lg bg-good/10 border-l-4 border-good">
        <span class="font-bold mr-2">良好:</span>
        <span>80-89分</span>
      </div>
      <div class="flex items-center p-3 rounded-lg bg-pass/10 border-l-4 border-pass">
        <span class="font-bold mr-2">及格:</span>
        <span>60-79分</span>
      </div>
      <div class="flex items-center p-3 rounded-lg bg-fail/10 border-l-4 border-fail">
        <span class="font-bold mr-2">不及格:</span>
        <span>0-59分</span>
      </div>
    </div>
  </div>

  <!-- 主内容区域 -->
  <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">成绩等级计算器</h1>
    <p class="text-gray-600 mb-6">输入你的分数，查看对应的等级评定</p>

    <div class="flex flex-col md:flex-row gap-6">
      <!-- 左侧输入区域 -->
      <div class="w-full md:w-1/2">
        <form class="space-y-4">
          <div class="flex flex-col sm:flex-row sm:items-center gap-4">
            <label for="score" class="text-gray-700 font-medium w-24">你的分数:</label>
            <div class="flex-1 relative">
              <input
                type="number"
                id="score"
                [(ngModel)]="score"
                name="score"
                placeholder="请输入0-100之间的分数"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                [class.border-red-500]="errorMessage"
              >
              <div *ngIf="errorMessage" class="absolute -bottom-6 left-0 text-red-500 text-sm">
                <i class="fa fa-exclamation-circle mr-1"></i>{{ errorMessage }}
              </div>
            </div>
          </div>
          <div class="flex justify-end">
            <button
              type="button"
              (click)="calculateGrade()"
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center"
            >
              <i class="fa fa-calculator mr-2"></i>计算等级
            </button>
          </div>
        </form>
      </div>

      <!-- 右侧结果展示区域 -->
      <div class="w-full md:w-1/2 flex items-center justify-center" *ngIf="showResult">
        <div class="text-center">
          <div class="text-gray-700 mb-2">你的等级是</div>
          <div class="mb-4">
              <span
                [ngClass]="{
                  'bg-excellent text-white': grade === '优秀',
                  'bg-good text-white': grade === '良好',
                  'bg-pass text-white': grade === '及格',
                  'bg-fail text-white': grade === '不及格'
                }"
                class="inline-block px-6 py-3 rounded-full text-xl font-bold shadow-lg transform transition-all hover:scale-105"
              >
                {{ grade }}
              </span>
          </div>
          <div class="text-gray-600">
            <i class="fa fa-lightbulb-o text-yellow-500 mr-1"></i>
            <span>{{ tips }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 历史记录与统计卡片 -->
  <div class="bg-white rounded-xl p-6 card-shadow" *ngIf="history.length > 0">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-bold text-gray-800 flex items-center">
        <i class="fa fa-bar-chart text-green-500 mr-2"></i>历史记录与统计
      </h2>
      <button
        (click)="clearHistory()"
        class="text-red-500 hover:text-red-700 text-sm font-medium flex items-center transition-colors"
      >
        <i class="fa fa-trash-o mr-1"></i>清空历史
      </button>
    </div>

    <!-- 新增: 成绩趋势图表 -->
    <div class="mb-6">
      <h3 class="font-medium text-gray-700 mb-3">成绩趋势</h3>
      <div class="h-64">
        <canvas id="scoreChart"></canvas>
      </div>
    </div>

    <div class="space-y-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg">
          <div class="text-gray-500 text-sm">总计算次数</div>
          <div class="text-2xl font-bold text-gray-800">{{ history.length }}</div>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg">
          <div class="text-gray-500 text-sm">平均分</div>
          <div class="text-2xl font-bold text-gray-800">{{ averageScore.toFixed(1) }}</div>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg">
          <div class="text-gray-500 text-sm">最高分</div>
          <div class="text-2xl font-bold text-excellent">{{ maxScore }}</div>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg">
          <div class="text-gray-500 text-sm">最低分</div>
          <div class="text-2xl font-bold text-fail">{{ minScore }}</div>
        </div>
      </div>

      <div class="mt-6">
        <h3 class="font-medium text-gray-700 mb-2">最近计算记录</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded-lg overflow-hidden">
            <thead>
            <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
              <th class="py-3 px-4 text-left">序号</th>
              <th class="py-3 px-4 text-left">分数</th>
              <th class="py-3 px-4 text-left">等级</th>
              <th class="py-3 px-4 text-left">时间</th>
            </tr>
            </thead>
            <tbody class="text-gray-600 text-sm">
            <tr *ngFor="let item of recentHistory; let i = index" class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
              <td class="py-3 px-4">{{ i + 1 }}</td>
              <td class="py-3 px-4 font-medium">{{ item.score }}</td>
              <td class="py-3 px-4">
                    <span
                      [ngClass]="{
                        'text-excellent': item.grade === '优秀',
                        'text-good': item.grade === '良好',
                        'text-pass': item.grade === '及格',
                        'text-fail': item.grade === '不及格'
                      }"
                    >{{ item.grade }}</span>
              </td>
              <td class="py-3 px-4 text-gray-500 text-xs">{{ item.time }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/zone.js@0.13.3/dist/zone.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/core-js@3.32.2/minified.min.js"></script>

<script>
  // 使用简单的JavaScript类模拟Angular组件
  class ScoreCalculator {
    constructor() {
      this.score = '';
      this.grade = '';
      this.tips = '';
      this.errorMessage = '';
      this.showResult = false;
      this.history = [];
      this.scoreChart = null; // 新增: 图表对象

      // 初始化页面
      this.init();
    }

    init() {
      // 模拟Angular的变更检测
      setInterval(() => this.detectChanges(), 100);

      // 从本地存储加载历史记录
      this.loadHistory();
    }

    detectChanges() {
      // 更新所有绑定的DOM元素
      const elements = document.querySelectorAll('[((ngModel))]');
      elements.forEach(el => {
        const prop = el.getAttribute('((ngModel))');
        if (el.value !== this[prop]) {
          this[prop] = el.value;
        }
      });

      // 更新插值表达式
      document.querySelectorAll('[ngClass]').forEach(el => {
        const expr = el.getAttribute('ngClass');
        this.applyNgClass(el, expr);
      });

      // 更新条件显示
      document.querySelectorAll('[*ngIf]').forEach(el => {
        const expr = el.getAttribute('*ngIf');
        el.style.display = this[expr] ? '' : 'none';
      });
    }

    applyNgClass(el, expr) {
      // 解析ngClass表达式并应用类
      const classMap = eval(`(${expr})`);
      Object.keys(classMap).forEach(cls => {
        if (classMap[cls]) {
          el.classList.add(cls);
        } else {
          el.classList.remove(cls);
        }
      });
    }

    calculateGrade() {
      this.errorMessage = '';
      this.showResult = false;

      const score = parseFloat(this.score);

      // 验证输入
      if (isNaN(score)) {
        this.errorMessage = '请输入有效的数字';
        return;
      }

      if (score < 0 || score > 100) {
        this.errorMessage = '分数必须在0-100之间';
        return;
      }

      // 计算等级
      if (score >= 90) {
        this.grade = '优秀';
        this.tips = '太棒了！继续保持！';
      } else if (score >= 80) {
        this.grade = '良好';
        this.tips = '做得很好，继续努力！';
      } else if (score >= 60) {
        this.grade = '及格';
        this.tips = '成绩合格，还有提升空间！';
      } else {
        this.grade = '不及格';
        this.tips = '需要加油了，继续努力！';
      }

      this.showResult = true;

      // 记录历史
      this.recordHistory(score, this.grade);

      // 保存历史到本地存储
      this.saveHistory();

      // 更新图表
      this.updateChart();
    }

    recordHistory(score, grade) {
      const now = new Date();
      const time = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

      this.history.push({ score, grade, time });

      // 计算统计数据
      this.updateStatistics();
    }

    updateStatistics() {
      if (this.history.length === 0) return;

      const scores = this.history.map(item => item.score);
      this.averageScore = scores.reduce((sum, score) => sum + score, 0) / scores.length;
      this.maxScore = Math.max(...scores);
      this.minScore = Math.min(...scores);

      // 限制显示最近5条记录
      this.recentHistory = [...this.history].reverse().slice(0, 5);
    }

    // 新增: 保存历史记录到本地存储
    saveHistory() {
      localStorage.setItem('scoreHistory', JSON.stringify(this.history));
    }

    // 新增: 从本地存储加载历史记录
    loadHistory() {
      const savedHistory = localStorage.getItem('scoreHistory');
      if (savedHistory) {
        this.history = JSON.parse(savedHistory);
        this.updateStatistics();
        this.updateChart();
      }
    }

    // 新增: 清空历史记录
    clearHistory() {
      if (confirm('确定要清空所有历史记录吗？')) {
        this.history = [];
        this.saveHistory();
        this.updateStatistics();
        this.updateChart();
      }
    }

    // 新增: 更新成绩趋势图表
    updateChart() {
      if (this.history.length === 0) return;

      const ctx = document.getElementById('scoreChart');
      if (!ctx) return;

      // 准备图表数据
      const scores = this.history.map(item => item.score);
      const labels = this.history.map((item, index) => `第${index + 1}次`);

      // 定义等级颜色
      const getColor = (score) => {
        if (score >= 90) return '#10b981'; // 优秀
        if (score >= 80) return '#3b82f6'; // 良好
        if (score >= 60) return '#f59e0b'; // 及格
        return '#ef4444'; // 不及格
      };

      const borderColors = scores.map(score => getColor(score));
      const backgroundColors = borderColors.map(color => `${color}40`); // 半透明

      // 如果图表已存在，销毁它
      if (this.scoreChart) {
        this.scoreChart.destroy();
      }

      // 创建新图表
      this.scoreChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: '分数',
            data: scores,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            borderWidth: 2,
            pointBackgroundColor: borderColors,
            pointBorderColor: '#fff',
            pointBorderWidth: 1,
            pointRadius: 5,
            pointHoverRadius: 7,
            tension: 0.2,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(255, 255, 255, 0.9)',
              titleColor: '#333',
              bodyColor: '#666',
              borderColor: '#ddd',
              borderWidth: 1,
              padding: 10,
              displayColors: false,
              callbacks: {
                label: function(context) {
                  const score = context.raw;
                  let grade = '';
                  if (score >= 90) grade = '优秀';
                  else if (score >= 80) grade = '良好';
                  else if (score >= 60) grade = '及格';
                  else grade = '不及格';
                  return `分数: ${score} (${grade})`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              min: Math.max(0, Math.min(...scores) - 10),
              max: Math.min(100, Math.max(...scores) + 10),
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                stepSize: 10
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }
  }

  // 初始化应用
  document.addEventListener('DOMContentLoaded', () => {
    window.app = new ScoreCalculator();
  });
</script>
</body>
</html>
